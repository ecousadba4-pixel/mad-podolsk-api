@layer components {
  /* Layout grid, containers and panel primitives extracted from layout.css */

  /* Toasts (global) */
  .toast {
    /* moved from `_overrides.scss` — keep toast offsets token-driven */
    position: fixed;
    bottom: var(--fab-offset);
    right: var(--fab-offset);
    background: var(--bg-card);
    padding: var(--card-padding) var(--gap-xl);
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-soft);
    animation: slide-in 0.3s ease;
    z-index: 1000;
  }

  @media (prefers-reduced-motion: reduce) {
    .toast { animation: none; }
  }
  .toast.success { border-left: 4px solid var(--success); }
.toast.error   { border-left: 4px solid var(--danger); }

/* Panel primitive: generic surface for sections and panels used across views
   Panels are layout primitives and belong to the layout module so they
   consistently inherit tokens for background, border and shadow. */
.panel {
  background: var(--bg-card);
  border: 1px solid var(--border-soft);
  box-shadow: var(--shadow-soft);
  border-radius: var(--radius-lg);
  padding: var(--card-padding);
}

/* Unified panel title styles for dashboard blocks (contract execution, smeta cards, smeta details)
   Apply within the dashboard scope so other panels keep their defaults. */
.dashboard .panel-title,
.dashboard .panel-title-mobile-value {
  /* Используем DIN-стиль заголовков (при наличии — подставить реальный DIN через @font-face). */
  font-family: var(--font-din);
  font-size: var(--font-size-h3);
  font-weight: 700;
  color: var(--text-main);
  margin: 0 0 calc(var(--gap-sm));
  line-height: 1.12;
  /* чуть более компактный трекин, характерный для DIN */
  letter-spacing: -0.02em;
  text-transform: none;
  /* prevent header titles from wrapping in dashboard panels; keep ellipsis
     to avoid layout shifts when title is long. Mobile overrides below. */
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* Ensure all dashboard panel title groups align to a common left axis
   This makes titles start at the same horizontal position across different
   panels/cards regardless of internal controls or variations in header layout. */
.dashboard .panel-title-group {
  padding-left: var(--card-inner-gap);
}

/* Add consistent vertical gap between panel header/title and panel content
   Use card-inner-gap so the spacing matches internal card padding. */
.panel > .panel-header { margin-top: var(--card-inner-gap); margin-bottom: var(--card-inner-gap); }
.panel .panel-header h3.panel-title,
.panel h3.panel-title { margin-bottom: calc(var(--card-inner-gap) / 2); }

/* Slightly smaller title for compact card headers (smeta cards) */
.dashboard .smeta-card header h3,
.dashboard .panel-title-group > h3.panel-title {
  font-size: clamp(1.05rem, 1.6vw, var(--font-size-h3));
}

/* Remove visual separator line that may appear between panel header and body
   Some templates insert small borders or hr elements; normalize by removing
   top/bottom borders between header and body to keep panels visually clean. */
.panel .panel-header { border-bottom: none; }
.panel hr { display: none; }
.panel > .panel-header + * { border-top: none; }
.contract-execution__body { border-top: none; }

/* Smeta panel (specific tweaks used in dashboard views) */
.smeta-panel {
  /* keep default panel appearance but allow smeta-specific padding rules
     to be overridden in `components.css` where layout interactions exist */
  background: var(--bg-card);
  border: 1px solid var(--border-soft);
  box-shadow: var(--shadow-card);
  border-radius: var(--radius-lg);
}

/* Contract card + progress bar */
.contract-card {
  background: var(--bg-card);
  border-radius: var(--radius-lg);
  border: 1px solid var(--border-soft);
  box-shadow: var(--shadow-card);
  padding: var(--card-padding);
  display: grid;
  gap: var(--gap-md);
  margin-bottom: 0; /* delegate vertical spacing to container gap */
  min-height: var(--control-height);
}

/* Dashboard grid should control spacing between top-level panels/cards */
.dashboard__grid {
  display: flex;
  flex-wrap: wrap;
  gap: var(--card-frame-gap);
  align-items: flex-start;
  width: 100%;
  max-width: 100vw;
  transition: opacity 200ms ease, filter 200ms ease;
}

/* Плавное затемнение при загрузке новых данных */
.dashboard__grid.is-loading {
  opacity: 0.7;
  filter: saturate(0.85);
  pointer-events: none;
}

.contract-card-header { display:flex; flex-direction:column; gap:var(--contract-meta-gap); }
.contract-card-title { font-weight:700; font-size:var(--font-size-h3); display:flex; align-items:baseline; gap:var(--gap-xs); }
.contract-card-values { display:flex; gap:var(--gap-sm); font-size:var(--font-size-numeric); flex-wrap:nowrap }
.contract-card-values > div { flex:1 1 0; min-width:0 }
.contract-card-values .label { font-size:0.75rem; letter-spacing:0.06em; text-transform:uppercase; color:var(--text-muted); display:block; margin-bottom:2px }

.contract-progress { padding-inline: var(--card-inner-gap); }
.contract-progress-bar {
  width:100%;
  height: var(--progress-height);
  background: var(--bg-muted);
  border: 1px solid var(--border-soft);
  border-radius: var(--radius-xxl);
  overflow:hidden;
  position:relative;
  box-shadow: inset 0 1px 0 rgb(255 255 255 / 50%);
}
.contract-progress-fill { height:100%; width:var(--progress,0%); background:var(--accent); transition: width 0.35s ease, background-color 0.2s ease; border-radius:var(--radius-xxl); box-shadow:var(--shadow-card); }
.contract-progress-fill.overflow { background: var(--success); }

@media (max-width: 640px) {
  /* Mobile: contract execution labels/values adapt to stacked layout */
  .contract-execution .panel-meta { display: flex; flex-direction: column; gap: calc(var(--gap-xs) * 0.6); }
  .contract-execution .panel-meta-row { display: flex; gap: var(--gap-md); align-items: center }
  .contract-execution .panel-meta-item { flex: 1 1 0; min-width: 0 }
  .contract-execution .panel-meta-label { text-align: left }
  .contract-execution .panel-meta-values .panel-meta-value { text-align: left }
}

/* On very small screens allow panel titles to wrap if mobile title variant is used */
@media (max-width: 640px) {
  .dashboard .panel-title,
  .dashboard .panel-title-mobile-value {
    white-space: normal;
    overflow: visible;
    text-overflow: clip;
  }

  /* Ensure contract execution panel title aligns with other dashboard blocks
     on small screens by using the standard inner gap token. */
  .dashboard .contract-execution .panel-title-group {
    padding-left: var(--card-inner-gap);
    padding-right: 0;
  }
}

/* Contract execution layout and meta (migrated from components.css) */
.contract-execution .panel-meta-label {
  font-size: var(--font-size-label);
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.06em;
}

.contract-execution .panel-meta-value {
  font-size: var(--font-size-numeric);
  font-weight: 600;
  color: var(--text-main);
  margin-top: var(--gap-sm);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  font-variant-numeric: tabular-nums;
  font-feature-settings: "tnum" 1;
}

@media (max-width: 640px) {
  .contract-execution .panel-meta-value {
    font-size: var(--font-size-body);
  }
}

@media (min-width: 768px) {
  .contract-execution .panel-meta-value { font-size: var(--font-size-numeric); }
}

.contract-execution .panel-title {
  font-size: var(--font-size-h2);
  font-weight: 700; /* align weight with other dashboard panel titles */
  font-family: var(--font-din);
  line-height: 1.12;
  letter-spacing: -0.02em;
  color: var(--text-main);
  text-align: left;
}

/* Ensure any contract-card specific title variant uses the same DIN family */
.dashboard .contract-card-title {
  font-family: var(--font-din);
  font-weight: 700;
  letter-spacing: -0.02em;
  line-height: 1.12;
}

@media (min-width: 768px) {
  .contract-execution .panel-meta { display: block; }
  .contract-execution .panel-meta-row { display: grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 48px; align-items: center; }
  .contract-execution .panel-meta-row.panel-meta-labels .panel-meta-item,
  .contract-execution .panel-meta-row.panel-meta-values .panel-meta-item { display: block; min-width: 0; justify-self: start; }
  .contract-execution .panel-meta-label, .contract-execution .panel-meta-value { text-align: left; justify-self: start; }
}

.contract-execution__body { padding-top: var(--gap-sm); }

/* Compact horizontal variant: reduce height and lay out meta horizontally */
.contract-execution--compact {
  /* tighter padding to reduce vertical height */
  padding: 8px var(--card-padding);
  min-height: 56px;
}
.contract-execution--compact .panel-header {
  display: grid;
  grid-template-columns: 1fr minmax(220px, 360px);
  align-items: center;
  gap: var(--gap-md);
}
.contract-execution--compact .panel-title {
  font-size: var(--font-size-body);
  margin: 0;
  line-height: 1.05;
}
.contract-execution--compact .panel-meta {
  display: block;
}
.contract-execution--compact .panel-meta-row {
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 12px;
  align-items: center;
}
.contract-execution--compact .panel-meta-item { min-width: 0; }
.contract-execution--compact .panel-meta-label {
  display: block;
  font-size: var(--font-size-label);
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.06em;
}
.contract-execution--compact .panel-meta-value { margin-top: 2px; text-align: right; }

/* Make progress match standard progress height used elsewhere (smeta cards) */
.contract-execution--compact .contract-progress__bar { height: var(--progress-height); border-radius: var(--radius-xxl); overflow: hidden; }
.contract-execution--compact .contract-progress__fill { height: 100%; display: block; }

/* reduce header spacing for compact card */
.contract-execution--compact > .panel-header { margin-top: 6px; margin-bottom: 6px; }

@media (max-width: 640px) {
  .contract-execution--compact .panel-header { grid-template-columns: 1fr; }
  .contract-execution--compact .panel-meta { justify-content: flex-start; }
  .contract-execution--compact .panel-meta-label { display:block; }
}

@media (max-width: 640px) {
  .contract-execution--compact.is-mobile .panel-header {
    display: flex;
    flex-direction: column;
    align-items: stretch;
    gap: 6px;
  }

  .contract-execution--compact.is-mobile .panel-title {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .contract-execution--compact.is-mobile .panel-meta {
    width: 100%;
  }

  .contract-execution--compact.is-mobile .panel-meta-row {
    display: grid;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    gap: var(--gap-sm);
    align-items: center;
  }

  .contract-execution--compact.is-mobile .panel-meta-label,
  .contract-execution--compact.is-mobile .panel-meta-value {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .contract-execution--compact.is-mobile .panel-meta-values .panel-meta-value {
    text-align: left;
  }

  /* Ensure the title group sits at the left edge of the header grid/column
     so the H3 aligns with other dashboard titles on small screens. */
  .contract-execution--compact.is-mobile .panel-title-group,
  .dashboard .contract-execution .panel-title-group {
    justify-self: start;
    align-items: flex-start;
    width: 100%;
  }
}

.contract-progress-labels { display:flex; align-items:center; justify-content:space-between; font-size:var(--font-size-label); color:var(--text-muted); text-transform:uppercase; letter-spacing:0.05em; margin-bottom:var(--gap-xs); }
.contract-progress-labels strong { font-size: var(--font-size-caption); color: var(--text-main); }


@media (min-width: 768px) {
  .contract-card-header { flex-direction:row; align-items:center; justify-content:space-between }
  .contract-card-values { gap: clamp(12px, 2vw, 18px); }
}

/* Page header and view switch */
.page-header {
  display:flex; flex-direction:column; gap:var(--card-frame-gap); margin-bottom: var(--grid-gap);
  padding: clamp(var(--gap-md), 2vw, var(--card-frame-gap)) 0;
}
.page-header-left { display:flex; flex-direction:column; gap:var(--gap-md) }
.page-header-right { display:flex; flex-direction:column; gap:var(--gap-md); align-items:stretch }
.header-actions { display:flex; align-items:center }

.view-switch { display:inline-flex; gap:var(--gap-xs); background:var(--bg-card); border-radius:var(--radius-md); padding:var(--gap-xs); box-shadow:var(--shadow-card); width:fit-content; min-height:var(--control-height); }
.view-tab { background:transparent; border:none; padding:var(--gap-xs) var(--gap-md); font-size:var(--font-size-label); font-weight:600; letter-spacing:0.02em; border-radius:var(--radius-sm); cursor:pointer; color:var(--text-muted); display:flex; flex-direction:column; align-items:center; justify-content:center; min-width:64px }
.view-tab.is-active { background:var(--accent); color:var(--text-inverse); box-shadow:var(--shadow-btn-primary) }

@media (min-width: 880px) {
  .page-header { flex-direction:row; justify-content:space-between; align-items:flex-end }
  .page-header-right { flex-direction:row; gap:var(--gap-lg); align-items:stretch }
  .page-header-left { flex:1 1 auto }
}

@media (max-width: 879px) {
  .view-switch { width:100%; min-height:54px }
  .view-tab { flex:1 1 0; text-align:center }
}

/* Router shell transitions */
.router-shell { position:relative; width:100% }
.fade-slide-enter-active, .fade-slide-leave-active { transition: opacity .18s ease, transform .18s ease; will-change: opacity, transform }
.fade-slide-enter-from { opacity:0; transform: translateY(6px) }
.fade-slide-enter-to   { opacity:1; transform: translateY(0) }
.fade-slide-leave-from { opacity:1; transform: translateY(0) }
.fade-slide-leave-to   { opacity:0; transform: translateY(-6px) }
/* Page layout, containers and small layout utilities
   Extracted from `layout.css` to keep grid & container primitives separate.
*/

@keyframes slide-in {
  from {
    transform: translateX(var(--slide-translate));
    opacity: 0;
  }

  to {
    /* moved from `_overrides.scss` */
    transform: translateX(0);
    opacity: 1;
  }
}

.page {
  --page-hpad: clamp(12px, 3vw, 28px);
  display: block;
  width: 100%;
  max-width: var(--page-max-width);
  margin-left: auto;
  margin-right: auto;
  padding-left: var(--page-hpad);
  padding-right: var(--page-hpad);
}

/* Inner content grid: keep previous `.page` flex/grid behaviour but scoped
   to `.page-content` so the page itself remains a centered container with
   side background on wide screens. */
.page-content {
  display: flex;
  flex-wrap: wrap;
  gap: var(--card-frame-gap);
  align-items: stretch;
  justify-content: flex-start;
}

/* Ensure top-level children of `.page` keep vertical spacing similar to previous `gap` behaviour */
.page > * { width: 100%; }
.page > * + * { margin-top: var(--card-frame-gap); }

/* Dashboard / smeta panel layout rules (migrated from components.css) */
.dashboard__grid > .contract-execution { flex: 1 1 100%; width: 100%; }

.dashboard__grid > .smeta-panel,
.smeta-panel {
  flex: 1 1 100%;
  width: 100%;
  max-width: 100%;
  margin-left: 0;
  margin-right: 0;
}

.smeta-panel { padding: calc(var(--card-padding) / 2) var(--card-padding) var(--card-padding) var(--card-padding); }

/* For full-bleed panels used in daily view, reduce the vertical gap
   between the panel header and the top edge so it matches other
   smeta panels in the Monthly view. This keeps header spacing
   consistent across dashboard blocks. */
/* Any panel-level full-bleed tweaks for specific components moved
   to `_daily-table.scss` so their scope is clearer. */

.dashboard__grid > .smeta-panel.smeta-details {
  flex: 1 1 100%;
  width: 100%;
  max-width: 100%;
  margin-left: 0;
  margin-right: 0;
}

@media (max-width: 640px) {
  .dashboard__grid > .smeta-panel,
  .smeta-panel {
    flex: 1 1 100%;
    width: 100%;
    max-width: 100%;
    margin-left: 0;
    margin-right: 0;
    padding-left: var(--card-padding);
    padding-right: var(--card-padding);
  }

  .smeta-card--large { width: 100%; }
}

/* Panel helpers (used in MonthlyDashboard, SmetaBreakdown) */
.panel-subtitle { color: var(--text-muted); margin-top: var(--gap-xs); }
.panel-note {
  display: block;
  color: var(--text-muted);
  margin-top: calc(var(--gap-xs) / 2);
  margin-bottom: calc(var(--gap-xs) / 2);
  font-size: var(--font-size-body-sm);
  line-height: 1.25;
  font-weight: 500;
}
}
